"use strict";define(["mui","utils/muiview","config/shareServices","utils/utils"],function(e,i,t,n){var s={};return s.getServices=function(n){function s(i){var t=[];if(i&&i[0]){var n=["qq","weixin"];i.forEach(function(i){if(n.indexOf(i.id)>-1)if("weixin"===i.id)for(var s=["WXSceneSession","WXSceneTimeline"],o=0,a=s.length;o<a;o++){var r=e.extend({},i);r.scene=s[o],r.key=[r.id,r.scene].join("-"),r.description=o>0?"朋友圈":"微信好友",t.push(r)}else i.description+="好友",i.key=i.id,t.push(i)})}var s=[{id:"copy",description:"复制链接",key:"copy",authenticated:!0,nativeClient:!1}];return t=t.concat(s)}i.osplus()?plus.share.getServices(function(e){n&&n(s(e))}):n&&n(s(t))},s.system=function(e){if(console.log("haha"),i.osplus())if("ios"===plus.os.name.toLocaleLowerCase()){var t=plus.ios["import"]("NSURL"),n=plus.ios["import"]("NSData"),o=plus.ios["import"]("UIImage"),a=plus.ios["import"]("NSMutableArray"),r=a.arrayWithCapacity(10);e.pictures.forEach(function(e){var i=t.URLWithString(e),s=n.dataWithContentsOfURL(i),a=o.imageWithData(s);r.addObject(a)});var l=plus.ios.importClass("UIActivityViewController"),c=new l,p=plus.ios.invoke(c,"initWithActivityItems:applicationActivities:",r,null);console.log("activity == "),console.log(JSON.stringify(p));var u=plus.ios.importClass("UIApplication"),v=u.sharedApplication(),d=plus.ios.invoke(v,"delegate"),f=plus.ios.invoke(d,"window"),h=plus.ios.invoke(f,"rootViewController");plus.ios.invoke(h,"presentViewController:animated:completion:",p,"YES",null)}else for(var m=[],g=e.pictures.length,w=function(t,n){switch(t.state){case 4:200===n?(m.push(plus.io.convertLocalFileSystemURL(t.filename)),g--,0===g&&(console.log("convertPic",m),s.weixinShare(m,e.title))):i.toast({message:"下载图片失败"});break;default:console.info("state: "+t.state)}},y=0;y<g;y++){var S=plus.downloader.createDownload(e.pictures[y]);S.addEventListener("statechanged",w,!1),S.start()}else;},s.weixinShare=function(e,i){var t=new Intent(Intent.ACTION_SEND_MULTIPLE);t.setType("image/*");for(var n=new ArrayList,s=0;s<e.length;s++){var o=e[s];n.add(Uri.fromFile(new File(o)))}t.putParcelableArrayListExtra(Intent.EXTRA_STREAM,n),t.putExtra(Intent.EXTRA_TEXT,i),t.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK),t.putExtra("Kdescription",i),main.startActivity(Intent.createChooser(t,"系统分享"))},s});