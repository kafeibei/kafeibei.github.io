"use strict";define(["mui","utils/utils","utils/storage","config/payRequest"],function(e,n,i,o){var t={};return t.alert=function(n){"string"==typeof n&&(n.message=n),n.title=n.title||"提示通知",e.alert(n.message,n.title,"知道了",function(e){n.onClose&&n.onClose()})},t.confirm=function(n){"string"==typeof n&&(n.message=n),n.title=n.title||"操作提示",e.confirm(n.message,n.title,null,function(e){n.onClose&&n.onClose(e.index>0)})},t.toast=function(n){"string"==typeof n&&(n.message=n);var i=2e3;e.toast(n.message||"操作成功",{duration:n.duration||i}),setTimeout(function(){n.onClose&&n.onClose()},n.duration||i)},t.osplus=function(){return e.os.plus},t.previewImage=function(){console.info("previewImage")},t.openWebview=function(i){var o=e.extend({id:"",url:"",styles:{},extras:{},createNew:!1,show:{aniShow:"slide-in-right"}},i);if(t.osplus())e.plusReady(function(){o.curId?plus.webview.getWebviewById(o.curId):plus.webview.currentWebview();e.openWindow(o);var n=plus.webview.getWebviewById(o.id);n&&(o.reload&&n.reload(),e.fire(n,"show",{}))});else{var s="";o.extras&&(s="?"+n.codeParam(o.extras));var a=window.location.origin+n.setpathname(o.url)+s,l=window.top.location.pathname.split("/")[2],r=window.location.pathname.split("/")[2];l===r?window.top.location.href=a:window.location.href=a}},t.subWebview=function(i){var o=i.url;if(!t.osplus()){var s="";i.extras&&(s=(n.setpathname(o).indexOf("?")>-1?"&":"?")+n.codeParam(i.extras)),o=window.location.origin+n.setpathname(o)+s}e.init({subpages:[{url:o,id:i.id,extras:i.extras,styles:i.styles}]})},t.webviewParams=function(i){if(t.osplus())e.plusReady(function(){var e=plus.webview.currentWebview();i&&i(e)});else{var o=n.getUrlParam();i&&i(o)}},t.curHref=function(){return t.osplus()?plus.webview.currentWebview().getURL():window.location.href},t.scrollY=function(n){e(n).scroll({scrollY:!0,scrollX:!1,startX:0,startY:0,indicators:!0,deceleration:6e-4,bounce:!0})},t.scrollX=function(n,i){e(n).scroll({scrollY:!1,scrollX:!0,indicators:!1,stopPropagation:!0,deceleration:6e-4,snap:i})},t.pullRefresh=function(n,i,o){var s=function(){var t={container:n};i&&(t.up={contentrefresh:"正在加载...",contentnomore:"别扯啦，到底了",callback:i}),o&&(t.down={height:50,contentdown:"下拉可以刷新",contentover:"释放立即刷新",contentrefresh:"正在刷新...",callback:o}),e.init({pullRefresh:t})};t.osplus()?e.plusReady(function(){s()}):s()},t.request=function(e,n,i){t.osplus()?plus.payment.request(e.channel,n,function(n){e.success&&e.success(n),i&&i(1)},function(n){console.error("fail"),e.fail&&e.fail(n),i&&i(-1)}):(e.success&&e.success(o[e.channel.id]),i&&i(1))},t.loading={waiting:null,show:function(){if(t.loading.isWaiting())return!1;if(t.osplus())t.loading.waiting=plus.nativeUI.showWaiting();else{var e=document.createElement("span");e.className="loading-container iconfont icon-loading",e.id="loading-spinner",document.body.appendChild(e),t.loading.waiting=e}},isWaiting:function(){return!!t.loading.waiting},close:function(){t.loading.isWaiting()&&(t.osplus()?(t.loading.waiting.close(),t.loading.waiting=null):(document.body.removeChild(t.loading.waiting),t.loading.waiting=null))}},t.btnloading={show:function(n){var i=e(n.target);i.button("loading")},close:function(n){var i=e(n.target);i.button("reset")}},t.webviewGroup=function(e,i){return t.osplus()?new webviewGroup(e,i):{switchTab:function(e,o){if(window.frames&&window.frames[0]){var s=window.location.href.split("?")[0]+"?"+n.codeParam(o);window.location.href=s}else i.items[0].extras=o,t.subWebview(i.items[0])}}},t.webviewPage=function(n,i){t.osplus()?e.plusReady(function(){i&&i(plus.webview.getWebviewById(n))}):i&&i({})},t.fire=function(n,o,s){if(t.osplus())e.plusReady(function(){var i=plus.webview.getWebviewById(n);i&&e.fire(i,o,{data:s})});else{var a={methods:o,pageId:n,data:s};n.indexOf("sub")>-1?window.frames[0].postMessage(a,"*"):i.set("pageParams",a)}},t.addEventListener=function(e,n,o){if(t.osplus())window.addEventListener(e,function(e){o&&o(e.detail.data)});else if(n.indexOf("sub")>-1)window.addEventListener("message",function(i){var t=i.data;return t?void(t.pageId===n&&t.methods===e&&o&&o(t.data)):void(o&&o())});else{var s=i.get("pageParams");s.methods===e&&s.pageId===n?o&&o(s.data):o&&o()}},t.closeWebview=function(n){t.osplus()&&e.plusReady(function(){if(n){var e=plus.webview.getWebviewById(n);e?plus.webview.close(e,"none"):console.error("pageId:"+n+"页面错误")}else{var i=plus.webview.currentWebview();i.close()}})},t.webviewMask=function(e,n){t.osplus()&&plus.webview.create("",e,n).show()},t.back=function(){t.osplus()?e.back():window.history.back()},t.platform=function(){return e.os.android?"android":e.os.ios?"ios":"unknown"},t.copyToClip=function(e){if(t.osplus()){if("ios"===t.platform()){var n=plus.ios.importClass("UIPasteboard"),i=n.generalPasteboard();i.setValueforPasteboardType(e,"public.utf8-plain-text")}else{var o=plus.android.importClass("android.content.Context"),s=plus.android.runtimeMainActivity(),a=s.getSystemService(o.CLIPBOARD_SERVICE);plus.android.invoke(a,"setText",e)}t.toast({message:"复制成功"})}else console.info("复制的内容是",e)},t.closeSplashscreen=function(){t.osplus()&&plus.navigator.closeSplashscreen()},t.setFullscreen=function(e){t.osplus()&&plus.navigator.setFullscreen(e)},t.getVersion=function(n){t.osplus()?e.plusReady(function(){plus.runtime.getProperty(plus.runtime.appid,function(e){n&&n(1,e.version)})}):n&&n(-1)},t});