"use strict";define(["mui","utils/muiview","utils/utils","config/payChannel","api/payment","config/router"],function(e,i,n,a,o,c){var l={};return l.getChannels=function(e){function n(e){var i=[];if(e&&e[0]){e.push({description:"余额",serviceReady:!1,id:"hdpay"},{description:"线下",serviceReady:!1,id:"offline"});var n=["alih5pay","alipay","wxpay","wxh5pay","hdpay","offline"];e.forEach(function(e){n.indexOf(e.id)>-1&&(e.title=e.description+"支付",e.isDisabled=!1,e.isDefault=!1,i.push(e))})}return i}i.osplus()?plus.payment.getChannels(function(i){e&&e(n(i))}):e&&e(n(a))},l.checkServices=function(e,n,a){if(e.serviceReady)n&&n();else{var o="";o="alipay"===e.id?"检测到系统未安装“支付宝快捷支付服务”，无法完成支付操作，是否立即安装？":"系统未安装“"+e.description+"”服务，无法完成支付，是否立即安装？",i.osplus()?plus.nativeUI.confirm(o,function(i){0===i.index?(console.info("去appStore安装"),n&&n(),e.installService&&e.installService()):a&&a()},e.title):i.confirm({title:e.title,message:o,onClose:function(e){e?n&&n():a&&a()}})}},l.allPay=function(a){var o={channel:"",orderCode:"",mobile:"",validcode:"",success:function(){},fail:function(){}};switch(o=e.extend(o,a),o.channel.id){case"alipay":case"wxpay":l.checkServices(o.channel,function(){i.loading.show();try{l.apiPay(o,"other")}catch(e){o.fail&&o.fail(e),i.loading.close()}},function(){o.fail&&o.fail(),i.loading.close()});break;case"offline":case"wxh5pay":l.apiPay(o,"self");break;case"alih5pay":var s={out_trade_no:"20180821235145455467008"};return window.location.href=window.location.origin+n.setpathname(c.payskip.url)+"?"+n.codeParam(s),!1;default:o.fail&&o.fail({error_message:"当前环境不支持此支付通道！"})}},l.apiPay=function(e,n){o[e.channel.id]?o[e.channel.id]({data:{orderCode:e.orderCode}}).then(function(a){"other"===n?i.request(e,a,function(e){i.loading.close()}):(e.success&&e.success(a),i.loading.close())})["catch"](function(n){e.fail&&e.fail(n),i.loading.close()}):(e.success&&e.success(),console.warn("channel:",e.channel),i.loading.close())},l.offlinePay=function(e,n){i.loading.show(),o.offlinepay({data:{orderCode:e.orderCode}}).then(function(n){e.success&&e.success(n),i.loading.close()})["catch"](function(n){e.fail&&e.fail(n),i.loading.close()})},l});