"use strict";require(["vue","components/navBar","global/components/hdpayView","utils/utils","utils/muiview","utils/payment","config/router","api/payment"],function(e,o,s,i,n,t,c,a){o(),s();new e({el:"#page-container",data:function(){return{title:"支付功能",navBarConfig:{left:{type:"icon",action:"back"}},channels:[],cid:"2018092072921205923730",hdpayPopover:{id:"hdpaysheet"}}},created:function(){var e=this;t.getChannels(function(o){e.channels=o})},methods:{goPay:function(e){var o=this;return!n.loading.isWaiting()&&(n.loading.show(),void this.checkIsPayOff(function(s,i){s>0?o.thirdPay(e):(n.loading.close(),console.error("订单查询是否支付:",i))}))},checkIsPayOff:function(e){a.checkIsPayOff({data:{orderCode:this.cid}}).then(function(o){e&&e(1)},function(o){"202"!==o.status?n.toast({message:o.error_message,onClose:function(){e&&e(-1,o.error_message)}}):n.toast({message:"该订单已支付",onClose:function(){e&&e(-1,"该订单已支付")}})})},thirdPay:function(e){var o=this;return"hdpay"===e.id?(mui("#"+this.hdpayPopover.id).popover("toggle"),n.loading.close(),!1):void t.allPay({channel:e,orderCode:this.cid,success:function(s){o[e.id+"Success"]?o[e.id+"Success"](s):console.warn("暂未提供"+e.id+"的回调方法"),n.loading.close()},fail:function(e){e?(console.error("接口访问错误："+(e.message||e.error_message)),n.toast({message:e.message||e.error_message,onClose:function(){n.loading.close()}})):n.loading.close()}})},hdpayFinish:function(){this.goSuccess({cid:this.cid,type:"hdpay"})},wxpaySuccess:function(e){this.goSuccess({cid:this.cid,type:"wxpay"})},offlineSuccess:function(e){this.goSuccess({cid:this.cid,type:"offline"})},wxh5paySuccess:function(e){if(e&&e.data){var o={out_trade_no:"20180821235145455467008",type:"wxpay"};return window.location.href=window.location.origin+i.setpathname(c.payskip.url)+"?"+i.codeParam(o),!1}},goSuccess:function(e){n.openWebview({url:c.paysuccess.url,id:c.paysuccess.id,extras:e})}}})});