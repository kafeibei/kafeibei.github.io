"use strict";define(["vue","components/record","utils/audio","utils/muiview","utils/utils","config/router"],function(i,o,n,e,t,s){o();var a=function(){i.component("upload-audio",{props:{data:Array,config:Object},template:'<div class="record-area">\n        <div class="img-upload audio-upload">\n          <div class="audio-box show-image hasimg" v-for="(item, index) in audioList" :key="index">\n            <div class="audio-area flex">\n              <div class="operate" @click="playAudio(item, index)">\n                <span class="iconfont icon-loaded" v-if="!item.loaded"></span>\n                <span v-else-if="playInfo.on === 1 && playInfo.index === index" class="iconfont icon-pause"></span>\n                <span v-else class="iconfont icon-play"></span>\n              </div>\n              <span class="time">{{item.intervalDuration || \'00:00\'}}</span>\n              <div class="process-line flex-one flex">\n                <div v-if="playInfo.on === 1 && playInfo.index === index" class="process-on" :style="processStyle"></div>\n                <div v-else class="process-on"></div>\n              </div>\n            </div>\n          </div>\n          <div class="img-box add-image" @click="triggerUpload()" v-if="data.length < config.maxlength">\n            <i class="el-icon-plus"></i>\n          </div>\n        </div>\n        <p class="tips-status" v-if="playInfo.on !== 0">当前播放状态：{{playInfo.on > 0 ? \'播放中；当前播放音频地址：\' + audioList[playInfo.index].src : \'已暂停\'}}</p>\n        <div :id="sheetPopover.id" class="mui-popover mui-popover-action mui-popover-bottom" v-if="this.sheetPopover.active">\n          <record-sheet :options="sheetPopover" @finish="doFinish"></record-sheet>\n        </div>\n  \t\t</div>',data:function(){return{audioList:[],playInfo:{on:0,index:-1},processStyle:{width:0},sheetPopover:{id:"sheetPopover",active:""}}},created:function(){var i=this;this.addEventListener(),this.data&&(this.audioList=this.data,this.audioList.forEach(function(o,n){i.$set(o,"loaded",!1),setTimeout(function(){i.getDuration(o.src,function(n){i.$set(o,"loaded",!0),i.$set(o,"duration",n),i.$set(o,"intervalDuration",t.intervalTime(n))})},200*n)}))},methods:{addEventListener:function(){var i=this;e.addEventListener("fireAudioChoose",s[this.config.key].id,function(o){o&&o.toLocalURL&&i.uploadAjax(o.toLocalURL)})},uploadAjax:function(i){var o=this;n.ajax(i,"audio",function(i,n){if(i>0){var e={src:n};o.getDuration(e.src,function(i){e.loaded=!0,e.duration=i,e.intervalDuration=t.intervalTime(i),o.audioList.push(e)})}})},getDuration:function(i,o){n.duration(i,function(i,n){i>0?o&&o(n):o&&o(0)})},triggerUpload:function(){var i=this;n.choose(this.config.key,function(o,n){return 0===o?(i.sheetPopover.active=i.config.key,setTimeout(function(){mui("#"+i.sheetPopover.id).popover("toggle")},50),!1):void(1===o&&e.openWebview({url:s.audiochoose.url,id:s.audiochoose.id,extras:{pageFrom:i.config.key}}))})},deleteAudio:function(i){var o=this;e.confirm({message:"确定删除此音频？",onClose:function(n){n&&o.audioList.splice(i,1)}})},doFinish:function(i,o){var n=this;if(this.sheetPopover.active="",i>0){var e={src:o};this.getDuration(e.src,function(i){e.duration=i,e.intervalDuration=t.intervalTime(i),n.audioList.push(e)})}},playAudio:function(i,o){var t=this;return!!i.loaded&&void(1===this.playInfo.on&&o===this.playInfo.index?n.stop(function(i){i>0&&(t.playInfo.on=-1,t.playInfo.index=-1)}):(this.playInfo.on>0&&n.stop(function(i){i>0&&(t.playInfo.on=-1,t.playInfo.index=-1)}),n.play(i.src,function(n,s){n<0?e.toast({message:s||"音频播放失败"}):(t.processStyle={width:0},t.processOn(i),t.playInfo.on=1,t.playInfo.index=o)})))},processOn:function(i){var o=this;n.getPosition(function(n,e){if(n>0)if(e===i.duration)o.processStyle={width:"100%"},o.playInfo.on=-1,o.playInfo.index=-1;else{var t=100*e/i.duration+"%";o.processStyle={width:t}}})}}})};return a});